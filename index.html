<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub AI Miner (Randomized)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background: #000; color: #fff; text-align: center; }
        input, button { padding: 12px; margin: 8px 0; width: 90%; border-radius: 8px; border: 1px solid #555; font-size: 16px;}
        input { background: #222; color: #fff; }
        button { background: #2563eb; color: white; cursor: pointer; font-weight: bold; border: none;}
        button.stop { background: #dc2626; margin-top: 20px;}
        
        /* ç‹€æ…‹é¢æ¿ */
        .panel { background: #1a1a1a; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(255,255,255,0.1); margin-bottom: 20px;}
        
        .log { 
            background: #111; padding: 15px; margin-top: 15px; 
            border: 1px solid #333; border-radius: 5px; 
            text-align: left; font-size: 0.85rem; color: #aaa; font-family: monospace;
            height: 300px; overflow-y: auto; white-space: pre-wrap;
        }
        
        .status-dot { height: 10px; width: 10px; background-color: #bbb; border-radius: 50%; display: inline-block; margin-right: 5px;}
        .active { background-color: #00ff00; box-shadow: 0 0 5px #00ff00;}
        .error { background-color: #ff0000; }

        #setup-panel, #mining-panel, #overlay { display: none; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <!-- 1. è¨­å®šå€ -->
    <div id="setup-panel" class="panel">
        <h2>âš™ï¸ è¨­å®š GitHub é€£ç·š</h2>
        <p style="font-size:0.8em; color:#bbb;">è³‡æ–™å°‡å­˜å›æ‚¨çš„ Repo</p>
        <input type="text" id="repoInput" placeholder="å¸³è™Ÿ/Repo (ä¾‹: Kevin/ai-data)">
        <input type="password" id="tokenInput" placeholder="GitHub Token (ghp_...)">
        <input type="text" id="promptInput" placeholder="åŸºç¤ Prompt (ä¾‹: å¯«ä¸€å€‹æ•…äº‹)" value="è«‹çµ¦æˆ‘ä¸€å€‹æ€§æ„›æ•…äº‹">
        <button onclick="saveSettings()">å„²å­˜è¨­å®š</button>
    </div>

    <!-- 2. æ›æ©Ÿé¢æ¿ -->
    <div id="mining-panel" class="panel">
        <h2>ğŸš€ AI è³‡æ–™ç¤¦å·¥ (éš¨æ©Ÿå…ƒç´ ç‰ˆ)</h2>
        <p>ç‹€æ…‹: <span id="status-dot" class="status-dot"></span><span id="status-text">å¾…æ©Ÿä¸­</span></p>
        <p>å·²ç”Ÿæˆç­†æ•¸: <span id="run-count" style="color: #4ade80; font-weight:bold;">0</span></p>
        <p>è·é›¢ä¸‹æ¬¡åˆ·æ–°: <span id="timer" style="color: #f87171; font-weight:bold;">--</span> ç§’</p>
        
        <div class="log" id="log-window">
            [System] ç­‰å¾…å•Ÿå‹•...
        </div>

        <button onclick="stopAndReset()" class="stop">åœæ­¢ä¸¦é‡è¨­è¨­å®š</button>
    </div>

    <!-- 3. å•Ÿå‹•é®ç½© -->
    <div id="overlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:99;display:flex;justify-content:center;align-items:center;flex-direction:column;">
        <h2 style="margin-bottom: 20px;">âš¡ é»æ“Šå•Ÿå‹•æ›æ©Ÿ âš¡</h2>
        <p style="color:#aaa; font-size:0.9em; max-width: 80%;">è«‹ä¿æŒæ­¤åˆ†é é–‹å•Ÿï¼Œä¸è¦åˆ‡æ›åˆ°èƒŒæ™¯ã€‚<br>ç³»çµ±å°‡è‡ªå‹•éš¨æ©ŸåŠ å…¥å…ƒç´ ç”Ÿæˆã€‚</p>
        <button onclick="startLoop()" style="width: 200px; font-size: 1.2em; padding: 20px; background: #22c55e;">é–‹å§‹åŸ·è¡Œ</button>
    </div>

    <!-- 4. å¼·åŠ›é˜²å¾…æ©Ÿå½±ç‰‡ -->
    <video id="noSleepVideo" playsinline muted loop style="position: absolute; width: 1px; height: 1px; opacity: 0.01; pointer-events: none; top:0; left:0;">
        <source src="https://raw.githubusercontent.com/richardschneider/nosleep.js/master/src/1sec.mp4" type="video/mp4">
    </video>

    <script src="https://js.puter.com/v2/"></script>
    <script>
        // ============================================
        // â˜… è‡ªå®šç¾©éš¨æ©Ÿå…ƒç´ åˆ—è¡¨ (è«‹åœ¨é€™è£¡ä¿®æ”¹ä½ æƒ³éš¨æ©ŸæŠ½å–çš„å…§å®¹)
        // ============================================
        const randomElements = [
            // é—œä¿‚èˆ‡è§’è‰²é¡
            "äº‚å€«ç¦å¿Œ", "æ¯å­äº‚å€«", "æ¯è¦ªèª˜æƒ‘å…’å­", "çˆ¶å¥³äº‚å€«", "çˆ¶è¦ªä¾µçŠ¯å¥³å…’", "å…„å¦¹äº‚å€«", "å…„å¦¹åˆæ¬¡æ€§æ„›",
            "å§å¼Ÿäº‚å€«", "å§å§èª¿æ•™å¼Ÿå¼Ÿ", "ç¹¼è¦ªäº‚å€«", "ç¹¼æ¯å‹¾å¼•ç¹¼å­", "å”å§ªäº‚å€«", "å”å”èˆ‡å§ªå¥³",
            "å­¿ç”Ÿå…„å¦¹", "é›™èƒèƒæ€§æ„›", "å®¶åº­ç¾¤äº¤", "å…¨å®¶äº‚å€«æ´¾å°",
            "äººå¦»å·æƒ…", "äººå¦»è¢«é„°å±…èª˜æƒ‘", "ç†Ÿå¥³èª˜æƒ‘", "ç†Ÿå¥³èˆ‡å¹´è¼•ç”·å­", "äººå¦»è¢«å§¦", "äººå¦»è¼ªå§¦æ´¾å°",
            "äººå¦»äº¤æ›", "å¤«å¦»äº¤æ›ä¼´ä¾¶", "åäººæ˜æ˜Ÿ", "å¶åƒè—äººå¹»æƒ³", "ç²‰çµ²èˆ‡æ˜æ˜Ÿæ€§æ„›", "è€é—†èˆ‡å“¡å·¥",
            "è€é—†å¼·è¿«ç§˜æ›¸", "é†«ç”Ÿèˆ‡ç—…äºº", "é†«ç”Ÿæª¢æŸ¥è®Šæ€§æ„›", "è­¦å¯Ÿèˆ‡å«Œç–‘äºº", "å¥³è­¦åˆ¶æœèª˜æƒ‘",
        
            // å¸«ç”Ÿèˆ‡æ ¡åœ’é¡
            "å¸«ç”Ÿæˆ€", "å¥³è€å¸«èª˜æƒ‘å­¸ç”Ÿ", "ç”·è€å¸«èª¿æ•™å¥³ç”Ÿ", "æ ¡åœ’é’æ˜¥", "å­¸ç”Ÿå¦¹èª˜æƒ‘", "è™•å¥³å­¸ç”Ÿç ´è™•",
            "è™•ç”·å­¸ç”Ÿåˆé«”é©—", "æ ¡åœ’æ¬ºå‡Œè®Šæ€§æ„›", "å®¿èˆå®¤å‹æ€§æ„›",
        
            // åŒæ€§èˆ‡å¤šå…ƒæ€§å‘é¡
            "åŒæ€§ç”·ç”·", "ç”·ç”·é¦–æ¬¡", "ç”·ç”·æµªæ¼«", "åŒæ€§å¥³å¥³", "å¥³å¥³è¦ªå»èˆ”é™°", "å¥³å¥³äº‚å€«", "é›™æ€§æˆ€ä¸‰è§’",
            "è·¨æ€§åˆ¥æˆ€æƒ…", "è®Šè£çš‡å", "å¥³æ€§åŒ–è½‰å‹", "è·¨æ€§åˆ¥æ€§æ„›", "Femboyç”·å­©", "Twinkå¹´è¼•ç”·å­",
        
            // æš´åŠ›èˆ‡å¼·åˆ¶é¡
            "å¼·æš´è¼ªå§¦", "è¿·å§¦ç”¨è—¥", "è…¦æ´—æ§åˆ¶", "ç¶ç¸›èª¿æ•™", "SMè™å¾…", "å¥´éš¸è¨“ç·´", "è®Šæ…‹å‡Œè¾±",
            "éè‡ªé¡˜æ€§æ„›", "å¼·è¿«é«˜æ½®", "è¼•åº¦ç¶ç¸›", "çš®é©é“å…·",
        
            // ç¾¤é«”èˆ‡å¤šäººé–“é¡
            "ç¾¤äº¤å¤šP", "è¼ªå§¦å¤šäºº", "3Pé›™é£›", "å…©ç”·ä¸€å¥³", "å…©å¥³ä¸€ç”·", "æ›å¦»ä¼´ä¾¶äº¤æ›", "æ´¾å°ç¾¤äº¤",
            "å…­äººæ··æˆ°", "å¤šäººè¼ªæµ",
        
            // é¦–æ¬¡èˆ‡ç‰¹æ®Šç¶“é©—é¡
            "é¦–æ¬¡ç ´è™•", "è™•å¥³ç ´è™•", "è™•ç”·åˆé«”é©—", "é¦–æ¬¡è‚›äº¤", "é¦–æ¬¡å£äº¤", "åå…«æ­²è™•å¥³", "åå…«æ­²è™•ç”·",
            "å¥³æ€§è‡ªæ…°", "å¥³æ€§é«˜æ½®", "å¥³æ€§é¦–æ¬¡é«˜æ½®",
        
            // å¥‡å¹»èˆ‡ç•°ç¨®é¡
            "å¥‡å¹»æ€ªç‰©", "è§¸æ‰‹ç•°ç¨®ä¾µçŠ¯", "ç§‘å¹»æœªä¾†æ€§æ„›", "äººå¤–æˆ€æƒ…", "èº«é«”æ“´å¼µ", "ä¹³æˆ¿æ“´å¼µ", "è½‰å‹è®Šèº«",
            "ç¹æ®–æ‡·å­•å¹»æƒ³", "å¸è¡€é¬¼æ€§æ„›", "ç‹¼äººæ€§æ„›",
        
            // æš´éœ²èˆ‡è§€å¯Ÿé¡
            "æš´éœ²å±•è¦½", "å…¬å…±æš´éœ²", "å·çªºè§€å¯Ÿ", "æˆ¶å¤–é‡åˆ", "é›»å½±é™¢æ‘¸ç´¢", "é›»æ¢¯å¯†å®¤æš´éœ²", "å·çªºé„°å±…æ€§æ„›",
        
            // è·æ¥­èˆ‡ç©¿æ­æœè£é¡
            "è·æ¥­åˆ¶æœ", "è­·å£«åˆ¶æœèª˜æƒ‘", "å¥³è­¦åˆ¶æœ", "ç©ºå§åˆ¶æœ", "ç§˜æ›¸OLè£", "å¥³åƒ•è£ä¾å¥‰",
            "çµ²è¥ªé«˜è·Ÿ", "é»‘çµ²ç™½çµ²", "åŠå¸¶è¥ª", "ç·Šèº«è¡£", "æ³³è£æ¯”åŸºå°¼", "å…§è¡£èª˜æƒ‘", "å…§è¤²æˆ€ç‰©",
            "çš®é©è£å‚™", "è•¾çµ²å…§è¡£", "èƒ¸ç½©è„«è½",
        
            // å ´åœ°èˆ‡æƒ…å¢ƒé¡
            "æ ¡åœ’æ•™å®¤æ€§æ„›", "è¾¦å…¬å®¤æˆ€æƒ…", "å…¬è»Šè»Šå»‚æ‘¸ç´¢", "é›»æ¢¯å¯†å®¤", "é…’åº—é–‹æˆ¿", "æµ´å®¤æ·‹æµ´æ€§æ„›",
            "æˆ¶å¤–å…¬åœ’é‡æˆ°", "KTVåŒ…å»‚ç¾¤äº¤", "å®¶åº­è‡¥å®¤å·æƒ…", "å»æ‰€å·æƒ…", "åº¦å‡å‹åœ°æ€§æ„›", "çœŸæ„›æµªæ¼«æ€§æ„›",
            "è…¦æ´—æƒ…å¢ƒ", "è¨ˆåŠƒæœªä¾†æ€§æ„›",
        
            // ç‰¹æ®Šç™–å¥½èˆ‡èº«é«”é¡
            "æˆ€ç‰©ç™–å¥½", "è¶³æ§æˆ€è¶³", "å…§è¤²æˆ€ç‰©", "å·¨ä¹³è±è‡€", "æ‡·å­•ç¹æ®–", "å™´å¥¶å“ºä¹³", "è‚›äº¤å¾Œé–€",
            "å£äº¤æ·±å–‰", "é¡å°„åç²¾", "69å§¿å‹¢", "èˆ”é™°", "èˆ”è‚›", "å¥³æ€§æ”¯é…", "å¥³æ€§é †å¾", "ç”·æ€§æ”¯é…",
            "ç”·æ€§é †å¾", "BDSMé“å…·", "ç©å…·è‡ªæ…°", "æŒ¯å‹•å™¨ä½¿ç”¨",
        
            // èƒŒæ™¯èˆ‡é¢¨æ ¼é¡
            "æ­¦ä¿ å¤è£", "æ­·å²å®®å»·å¾Œå®®", "éƒ½å¸‚è±”é‡", "è¾¦å…¬å®¤å·æƒ…", "é„°å±…èª˜æƒ‘", "æ´äº¤äº¤æ˜“",
            "å¦“å¥³ä¸€å¤œæƒ…", "ç¾å¥³è±”é‡", "æ·«è•©è•©å©¦", "è®Šæ…‹è‰²ç‹¼", "ææ€–æƒ…è‰²", "å¹½é»˜è«·åˆºæ€§æ„›",
            "ç§‘å¹»å¹»æƒ³", "éäººé¡ç”Ÿç‰©", "ä¿¡ä»¶æ—¥è¨˜å½¢å¼", "è©•è«–éš¨ç­†", "æ’åœ–æƒ…è‰²", "éŸ³é »æƒ…è‰²",
            "éè‹±æ–‡èªè¨€", "åäººç²‰çµ²å°èªª", "è·¨ç¨®æ—æˆ€æ„›"
        ];
        // ============================================

        const REFRESH_SECONDS = 30; // æ¯å¹¾ç§’è·‘ä¸€æ¬¡
        let totalRuns = 0;
        let isRunning = false;
        let wakeLock = null;

        function init() {
            const repo = localStorage.getItem('gh_repo');
            const token = localStorage.getItem('gh_token');

            if (repo && token) {
                document.getElementById('mining-panel').style.display = 'block';
                document.getElementById('overlay').style.display = 'flex';
                log("è¨­å®šå·²è¼‰å…¥ï¼Œç­‰å¾…ä½¿ç”¨è€…å•Ÿå‹•...");
                log(`ç›®å‰å…±æœ‰ ${randomElements.length} å€‹éš¨æ©Ÿå…ƒç´ å¾…å‘½ã€‚`);
            } else {
                document.getElementById('setup-panel').style.display = 'block';
            }
        }

        function saveSettings() {
            const repo = document.getElementById('repoInput').value.trim();
            const token = document.getElementById('tokenInput').value.trim();
            const prompt = document.getElementById('promptInput').value.trim();

            if (!repo || !token) return alert("è«‹å®Œæ•´å¡«å¯« Repo å’Œ Token");

            localStorage.setItem('gh_repo', repo);
            localStorage.setItem('gh_token', token);
            localStorage.setItem('gh_prompt', prompt);
            
            location.reload();
        }

        function stopAndReset() {
            if(confirm("ç¢ºå®šè¦åœæ­¢ä¸¦æ¸…é™¤æ‰€æœ‰è¨­å®šå—ï¼Ÿ")) {
                localStorage.clear();
                location.reload();
            }
        }

        async function startLoop() {
            document.getElementById('overlay').style.display = 'none';
            isRunning = true;
            updateStatus("active", "æ›æ©Ÿä¸­ - é˜²å¾…æ©Ÿå·²å•Ÿå‹•");

            const video = document.getElementById('noSleepVideo');
            try { await video.play(); } catch (err) { }
            requestWakeLock();
            runTask();
        }

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => { });
                }
            } catch (err) { console.log(err); }
        }

        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible') {
                await requestWakeLock();
                document.getElementById('noSleepVideo').play().catch(e=>{});
            }
        });

        // === ä»»å‹™åŸ·è¡Œé‚è¼¯ ===
        async function runTask() {
            if (!isRunning) return;

            const repo = localStorage.getItem('gh_repo');
            const token = localStorage.getItem('gh_token');
            const basePrompt = localStorage.getItem('gh_prompt') || "è«‹çµ¦æˆ‘ä¸€å€‹æ•…äº‹";

            updateStatus("active", "æ­£åœ¨æŠ½é¸å…ƒç´ ä¸¦ç”Ÿæˆ...");
            
            try {
                // 1. éš¨æ©ŸæŠ½é¸å…ƒç´ 
                const randomEl = randomElements[Math.floor(Math.random() * randomElements.length)];
                
                // 2. çµ„åˆæ–°çš„ Prompt
                const finalPrompt = `${basePrompt} (é—œæ–¼: ${randomEl})`;
                
                log(`[${totalRuns + 1}] é¡Œç›®: ${finalPrompt}`);
                log(`    å‘¼å« Puter AI ä¸­...`);

                // 3. Puter ç”Ÿæˆ
                const response = await puter.ai.chat(finalPrompt, {model: 'x-ai/grok-4-fast:free'});
                const content = response.message.content;
                
                log(`    -> ç”ŸæˆæˆåŠŸ (${content.length} å­—)ï¼Œä¸Šå‚³ä¸­...`);

                // 4. GitHub ä¸Šå‚³ (æ³¨æ„ï¼šé€™è£¡æˆ‘å€‘å‚³ finalPrompt çµ¦ instructionï¼Œé€™æ¨£è¨“ç·´è³‡æ–™æ‰æº–ç¢º)
                const apiUrl = `https://api.github.com/repos/${repo}/dispatches`;
                const ghResponse = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        event_type: 'save_story',
                        client_payload: {
                            prompt: finalPrompt, // å­˜å…¥ JSON çš„æ˜¯çµ„åˆå¾Œçš„ Prompt
                            content: content
                        }
                    })
                });

                if (!ghResponse.ok) throw new Error(`GitHub API: ${ghResponse.status}`);

                totalRuns++;
                document.getElementById('run-count').innerText = totalRuns;
                log("    -> ä¸Šå‚³æˆåŠŸï¼");

            } catch (err) {
                console.error(err);
                log(`[Error] ${err.message}`);
                updateStatus("error", "ç™¼ç”ŸéŒ¯èª¤ï¼Œç¨å¾Œé‡è©¦");
            }

            startCountdown(REFRESH_SECONDS);
        }

        function startCountdown(seconds) {
            let left = seconds;
            const timerDisplay = document.getElementById('timer');
            updateStatus("active", "å†·å»ä¼‘æ¯ä¸­...");

            const interval = setInterval(() => {
                left--;
                timerDisplay.innerText = left;
                if (left <= 0) {
                    clearInterval(interval);
                    runTask();
                }
            }, 1000);
        }

        function log(msg) {
            const box = document.getElementById('log-window');
            const time = new Date().toLocaleTimeString();
            box.innerText += `[${time}] ${msg}\n`;
            box.scrollTop = box.scrollHeight;
        }

        function updateStatus(type, text) {
            const dot = document.getElementById('status-dot');
            const txt = document.getElementById('status-text');
            dot.className = "status-dot " + type;
            txt.innerText = text;
        }

        init();
    </script>
</body>

</html>
